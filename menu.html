<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mes favoris</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="user-panel">
      <label for="username">Utilisateur :</label>
      <input type="text" id="username" placeholder="Entrez votre nom" />
      <button id="save-user">‚úîÔ∏è</button>
      <button id="export-favs">Exporter favoris</button>
      <button id="import-favs">Importer favoris</button>
      <textarea id="import-area" placeholder="Collez ici vos favoris JSON"></textarea>
    </div>

    <h1>Mon menu d‚Äôexercices</h1>
    <nav class="site-nav">
      <a href="index.html">Accueil</a>
    </nav>
  </header>

  <main class="site-content">
    <ul class="video-links" id="favoris-list">
      <!-- Rempli dynamiquement -->
    </ul>
  </main>

  <footer class="site-footer">
    <p>&copy; Cabinet Kin√©</p>
  </footer>

  <script>
  // --- Gestion du pseudo utilisateur ---
  const inputUser = document.getElementById("username");
  const btnSaveUser = document.getElementById("save-user");
  const btnExport = document.getElementById("export-favs");
  const btnImport = document.getElementById("import-favs");
  const importArea = document.getElementById("import-area");

  // Charge le pseudo en cours (ou vide)
  let currentUser = localStorage.getItem("currentUser") || "";
  inputUser.value = currentUser;

  function saveCurrentUser(name) {
    currentUser = name.trim();
    localStorage.setItem("currentUser", currentUser);
    // recharge la page ou mets √† jour l'affichage des favoris
    location.reload();
  }

  btnSaveUser.addEventListener("click", () => {
    if (inputUser.value) saveCurrentUser(inputUser.value);
  });

  // --- Fonctions de favoris par utilisateur ---
  function getFavoris() {
    if (!currentUser) return [];
    const key = `favoris_${currentUser}`;
    return JSON.parse(localStorage.getItem(key) || "[]");
  }

  function saveFavoris(arr) {
    if (!currentUser) return;
    localStorage.setItem(`favoris_${currentUser}`, JSON.stringify(arr));
  }

  // --- Export / Import ---
  btnExport.addEventListener("click", () => {
    const data = JSON.stringify(getFavoris());
    importArea.value = data;
    alert("Vos favoris ont √©t√© copi√©s dans la zone de texte : copiez-collez-les ailleurs !");
  });

  btnImport.addEventListener("click", () => {
    try {
      const arr = JSON.parse(importArea.value);
      if (!Array.isArray(arr)) throw "";
      saveFavoris(arr);
      alert("Favoris import√©s ! Rechargez la page pour voir le contenu.");
    } catch {
      alert("Format JSON invalide.");
    }
  });

  // --- Reste du script de favoris (boutons ‚ù§Ô∏è) ---
  function isInFavoris(id) {
    return getFavoris().some(item => item.id === id);
  }

  function toggleFavori(id, label, button) {
    const favs = getFavoris();
    const idx = favs.findIndex(f => f.id === id);
    if (idx !== -1) favs.splice(idx, 1);
    else favs.push({ id, label });
    saveFavoris(favs);
    button.textContent = isInFavoris(id) ? "‚ù§Ô∏è" : "ü©∂";
  }

  document.querySelectorAll(".fav-btn").forEach(button => {
    const id = button.dataset.id;
    const label = button.dataset.label;
    // √©tat initial
    button.textContent = isInFavoris(id) ? "‚ù§Ô∏è" : "ü©∂";
    button.addEventListener("click", () => toggleFavori(id, label, button));
  });

  // --- Pour menu.html uniquement : affichage des favoris ---
  const favList = document.getElementById("favoris-list");
  if (favList) {
    const arr = getFavoris();
    if (arr.length === 0) {
      favList.innerHTML = "<p>Aucun favori pour cet utilisateur.</p>";
    } else {
      favList.innerHTML = "";
      arr.forEach(video => {
        const li = document.createElement("li");
        li.innerHTML = `<a href="video.html?id=${video.id}&label=${encodeURIComponent(video.label)}">${video.label}</a>`;
        favList.appendChild(li);
      });
    }
  }
</script>

</body>
</html>
